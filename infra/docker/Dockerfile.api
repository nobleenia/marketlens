FROM golang:1.22-alpine AS build
WORKDIR /app

COPY services/api/go.mod services/api/go.sum ./services/api/
RUN cd services/api && go mod download

COPY services/api ./services/api
RUN cd services/api && CGO_ENABLED=0 go build -o /bin/marketlens-api ./cmd/server

FROM alpine:3.20
RUN adduser -D appuser
USER appuser
WORKDIR /home/appuser

COPY --from=build /bin/marketlens-api ./marketlens-api
EXPOSE 8080
ENTRYPOINT ["./marketlens-api"]
